<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<title>MP3: Refactoring and More JSON</title>
		<meta name="description" lang="en-us" content="The MP3 checkpoint introduces refactoring and makes it possible to configure multiplayer games.">
    <meta name="google-site-verification" content="y_Y-3Qy2OkNZGt3FSNhmY31PkAtFbaTGrDKrSZffbvE">

      <link rel="stylesheet" href="/static-assets/site.ce01e59baf542a8794f1.css">

      <script src="/static-assets/site.ce01e59baf542a8794f1.js" async></script>

		<link rel="icon" type="image/png" sizes="228x228" href="/img/favicon/coast-228x228.png">
		<link rel="yandex-tableau-widget" href="/img/favicon/yandex-browser-manifest.json">
		<link rel="apple-touch-icon" sizes="57x57" href="/img/favicon/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/img/favicon/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/img/favicon/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/img/favicon/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/img/favicon/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/img/favicon/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/img/favicon/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/img/favicon/apple-touch-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon-180x180.png">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta name="apple-mobile-web-app-title" content="CS 125">
		<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
		<link rel="shortcut icon" href="/img/favicon/favicon.ico">
		<link rel="manifest" href="/img/favicon/manifest.json">
		<meta name="mobile-web-app-capable" content="yes">
		<meta name="theme-color" content="#fff">
		<meta name="application-name" content="CS 125">
		<meta name="msapplication-TileColor" content="#fff">
		<meta name="msapplication-TileImage" content="/img/favicon/mstile-144x144.png">
		<meta name="msapplication-config" content="/img/favicon/browserconfig.xml">
		
    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js" defer></script>

    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-45109275-2', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
    <script>
      if (window.location.hostname === 'localhost') {
        window['ga-disable-UA-45109275-2'] = true
      }
    </script>
  </head>

  <body data-spy="scroll" data-target="#toc">
    <div id="navbarTop" class="fixed-top">
      <nav class="navbar navbar-expand navbar-light bg-white pb-2 flex-column flex-md-row">
        <a class="navbar-brand" href="/">
          <img src="/img/logos/cs125-wide-157x60.png" width="157" height="60" data-pagespeed-no-transform="true" class="d-none d-lg-inline-block align-top" alt="CS 125: Introduction to Computer Science">
          <img src="/img/logos/cs125-60x60.png" width="46" height="46" data-pagespeed-no-transform="true" class="d-inline-block d-lg-none align-top" alt="CS 125: Introduction to Computer Science">
        </a>
        <button id="sidebar-button" type="button" data-toggle="collapse" data-target="#sidebar" aria-controls="sidebar" aria-expanded="false" aria-label="Toggle navigation" class="d-block d-md-none" style="position: fixed; top: 20px; right: 20px;">
          <span class="navbar-toggler-icon"></span>
        </button>
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="/info/syllabus/">Info</a>
          </li>
          <li class="nav-item">
            <a class="nav-link noexternal" href="https://cs125-forum.cs.illinois.edu">Forum</a>
          </li>
          <li class="nav-item">
            <a class="nav-link noexternal" href="https://cs125-help.cs.illinois.edu">Help</a>
          </li>
          <!--
          <li class="nav-item">
            <a class="nav-link"
               href="/info/fair/"
               data-active="^info/fair"><strong>Fair</strong></a>
          </li>
          <li class="nav-item">
            <a class="nav-link"
               href="/info/join/"
               data-active="^(?!info/join)info">Join</a>
          </li>
          -->
          <li class="nav-item">
            <a class="nav-link" href="/learn/">Learn</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/info/people/">People</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" data-redirect="/MP" href="/MP/5/">MPs<span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-redirect="/lab" href="/lab/14/">Labs</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/m/grades/">Grades</a>
          </li>
        </ul>
        <ul class="navbar-nav ml-auto mr-2">
          <li id="login" class="d-flex mr-2 mr-xl-3"></li>
          <li class="d-none d-md-flex nav-item mr-2 mr-xl-3">
            <a href="//www.youtube.com/channel/UC8L44j0A6LAlC4FM8IiNx-w/videos" target="_blank" class="noexternal"><i class="fa fa-youtube-play fa-2x navbar-icon" aria-hidden="true"></i></a>
          </li>
          <li class="d-none d-md-flex nav-item">
            <a href="//github.com/cs125-illinois" target="_blank" class="noexternal"><i class="fa fa-github fa-2x navbar-icon" aria-hidden="true"></i></a>
          </li>
        </ul>
      </nav>
      <div class="fadeout"></div>
    </div>
    
    <!--
      vim: et:ts=2:sw=2:ft=html
    -->

<!--
  vim: et:ts=2:sw=2:ft=html
-->

<div id="content" class="container-fluid">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 sidebar">
      <div id="sidebar" class="collapse">
        <nav class="nav flex-column">
          <ul class="section-nav">
            <li>
              <a href="/MP/5/">MP5</a>
            </li>
            <li>
              <a href="/MP/4/">MP4</a>
            </li>
            <li>
              <a href="/MP/3/" class="active" onclick="return false;">MP3<span class="sr-only">(current)</span></a>
            </li>
            <li>
              <a href="/MP/2/">MP2</a>
            </li>
            <li>
              <a href="/MP/1/">MP1</a>
            </li>
            <li>
              <a href="/MP/0/">MP0</a>
            </li>
            <li>
              <span data-active="^MP/setup" class="option">Setup</span>
              <ul>
                <li>
                  <a href="/MP/setup/android-studio/">Android Studio</a>
                </li>
                <li>
                  <a href="/MP/setup/git/">Git</a>
                </li>
                <!--
                <li>
                  <a data-active="^MP/setup/EWS" href="/MP/setup/EWS/">EWS</a>
                </li>
          	  -->
              </ul>
            </li>
            <li>
              <span class="option">Archive</span>
              <ul>
                <li>
                  <a href="/MP/2019/fall/0/">Fall 2019</a>
                </li>
                <li>
                  <a href="/MP/2019/spring/0/">Spring 2019</a>
                </li>
                <li>
                  <a href="/MP/2018/fall/0/">Fall 2018</a>
                </li>
                <li>
                  <a href="/MP/2018/spring/0/">Spring 2018</a>
                </li>
                <li>
                  <a href="/MP/2017/fall/1/">Fall 2017</a>
                </li>
              </ul>
            </li>
          </ul>
          
          <!--
            vim: et:ts=2:sw=2:ft=html
          -->
        </nav>
        <div class="fadeout"></div>
      </div>
    </div>
    <div class="col-md-3 col-xl-2" style="z-index: -1;"></div>

    <div class="col-xl-3 d-none d-xl-block toc">
      <nav id="toc" class="nav flex-column">
        <ul class="section-nav">
          <li class="entry">
            <a class="nav-link" href="#top">1. Learning Objectives</a>
          </li>
          <li class="entry">
            <a class="nav-link" href="#_assignment_structure">2. Assignment Structure</a>
            <ul>
              <li><a class="nav-link" href="#_obtaining_mp3">2.1. Obtaining MP3</a></li>
              <li><a class="nav-link" href="#_late_submissions">2.2. Late Submissions</a></li>
            </ul>
          </li>
          <li class="entry">
            <a class="nav-link" href="#_tools_and_resources">3. Tools and Resources</a>
            <ul>
              <li><a class="nav-link" href="#lists">3.1. Lists</a></li>
              <li><a class="nav-link" href="#gson">3.2. Writing JSON with Gson</a></li>
              <li><a class="nav-link" href="#api">3.3. Our API Documentation</a></li>
              <li><a class="nav-link" href="#presets_api">3.4. Extra Credit API Documentation</a></li>
              <li><a class="nav-link" href="#git_revert">3.5. Reverting Changes with Git</a></li>
            </ul>
          </li>
          <li class="entry">
            <a class="nav-link" href="#goal">4. Your Goal</a>
            <ul>
              <li><a class="nav-link" href="#target">4.1. The Target Class</a></li>
              <li><a class="nav-link" href="#latlng">4.2. LatLng Refactor</a></li>
              <li><a class="nav-link" href="#game_setup">4.3. The GameSetup Class</a></li>
              <li><a class="nav-link" href="#_game_setup_ui">4.4. Game Setup UI</a></li>
              <li><a class="nav-link" href="#presets">4.5. Extra Credit: Target Presets</a></li>
            </ul>
          </li>
          <li class="entry">
            <a class="nav-link" href="#grading">5. Grading</a>
          </li>
          <li class="entry">
            <a class="nav-link" href="#_cliffhanger">6. Cliffhanger</a>
          </li>
          <li class="entry">
            <a class="nav-link" href="#_cheating">7. Cheating</a>
          </li>
        </ul>
      </nav>
    </div>

    <main class="col-12 col-md-9 col-xl-7 py-3">


      <a class="anchor" id="top"></a>
        <h1>MP3: Refactoring and More JSON</h1>
      <div class="paragraph lead">
<p>In <a href="/MP/2/">MP2</a>, you connected the app to our game server to get and respond
to invitations.
In Checkpoint 3, you&#x2019;ll make it possible to create multiplayer games of the two
game modes and <em>refactor</em> some of your old code to improve it.</p>
</div>
<div class="paragraph">
<p>When you first started working on the MP, we hadn&#x2019;t covered object-oriented
programming yet, so the target mode functionality had to be implemented using
only arrays and imperative programming.
As you discovered, that was not ideal.
Programmers often learn or realize better approaches to problems already solved
and revisit old code to improve it.
This process is called <em>refactoring</em>.
In this checkpoint we&#x2019;ll refactor some of the code you wrote in MP0 and organize
some relevant logic into a class that can more easily be used in the next
checkpoint.</p>
</div>
<div class="paragraph">
<p><strong>Checkpoint 3 is a one week MP, so you only have one deadline</strong>, which varies
by your deadline group. MP3 is due at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>11:59 PM on Sunday, 03/29/2020 for the Blue Group</strong>: all labs starting at 3 PM or earlier</p>
</li>
<li>
<p><strong>11:59 PM on Monday, 03/30/2020 for the Orange Group</strong>: all labs starting at 4 PM or later</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Late submissions are subject to the
<a href="/info/syllabus/#regrading">MP late submission policy</a>.</p>
</div>
<div class="openblock alert alert-warning">
<div class="content">
<div class="paragraph">
<p><strong>However, note that we will adjust the deadline as needed depending on the
success of our efforts to provide virtual support.</strong></p>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_learning_objectives"></a><h2>1. Learning Objectives</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On MP3 you will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Work with and improve older code</p>
</li>
<li>
<p>Build JSON objects to deliver additional information to the web API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will continue to exercise your class design like in previous checkpoints.</p>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_assignment_structure"></a><h2>2. Assignment Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For information on all classes present after the completion of Checkpoint 3,
refer to our
<a href="https://cs125-illinois.github.io/Spring2020-MP-Writeups/3/overview-summary.html" target="_blank" class="external">official
Javadoc</a>.</p>
</div>
<div class="sect2">
<a class="anchor" id="_obtaining_mp3"></a><h3>2.1. Obtaining MP3</h3>
<div class="paragraph">
<p>To update your project with the remote and get started on MP3, follow these instructions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Get the remote code.</strong>
Select <em>VCS | Git | Fetch</em> from the menu to download the remote commit.
However, it still needs to be merged with your work.</p>
</li>
<li>
<p><strong>Merge the changes!</strong>
Now we need to merge the changes from your computer with our remote repository,
so go back to the menu and choose <em>VCS | Git | Merge Changes</em>.
Check the <code>remotes/release/mp3</code> branch you just fetched and press Merge!
The Version Control pane will appear to inform you of items updated from the
server.</p>
</li>
<li>
<p><strong>Update <code>grade.yaml</code>.</strong>
Open the file in the root of the project, change the <code>checkpoint</code> setting to
<code>3</code>, and do <em>File | Sync Project with Gradle Files</em>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<a class="anchor" id="_late_submissions"></a><h3>2.2. Late Submissions</h3>
<div class="paragraph">
<p>Like in previous checkpoints, setting <code>useProvided</code> in <code>grade.yaml</code> to <code>true</code>
causes the app to use our provided components rather than your implementations.
For Checkpoint 3, we provide <code>TargetVisitChecker</code> (with both MP0-style and
refactored signatures), <code>AreaDivider</code>, the launch activity, the main activity,
and the gameplay logic in <code>GameActivity</code>.</p>
</div>
<div class="paragraph">
<p>As usual, you can always go back and make submissions to previous checkpoints by
changing <code>checkpoint</code> in <code>grade.yaml</code>.
However, merging MP3 will produce compilation errors until you add the classes
expected by the new test suite.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_tools_and_resources"></a><h2>3. Tools and Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides you with tools and information that you will need to complete the
features in <a href="#goal">Your Goal</a>.</p>
</div>
<div class="sect2">
<a class="anchor" id="lists"></a><h3>3.1. Lists</h3>
<div class="paragraph">
<p>Java arrays are useful for storing multiple values of the same type, but an
array&#x2019;s length cannot be changed after its creation.
Often it&#x2019;s not known in advance how many entries a collection will have, or the
collection has items added to or removed from it.
In those situations, arrays are inconvenient.</p>
</div>
<div class="paragraph">
<p>Fortunately, Java provides <em>lists</em>: objects that hold dynamically resizable
lists of things.
All lists are instances of
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html" target="_blank" class="external"><code>List</code></a>,
but <code>List</code> is an interface rather than a concrete type.
To create a list you create an instance of a <code>List</code> implementation, the most
common of which is
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/ArrayList.html" target="_blank" class="external"><code>ArrayList</code></a>.
This is an example of <em>polymorphism</em>.</p>
</div>
<div class="paragraph">
<p>When you declared arrays, you put the element type before square brackets, like
<code>String[]</code> for an array of strings.
List variables are declared like <code>List&lt;String&gt;</code>, with the element type in angle
brackets.
To declare a list-of-strings variable and initialize it to an empty <code>ArrayList</code>,
you would use code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">List&lt;String&gt; names = new ArrayList&lt;&gt;();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The angle brackets on the right side of the assignment can be empty, which means
that the actual list object created holds the same type of values as the
variable is declared to contain.</p>
</div>
<div class="paragraph">
<p>The <code>List</code> type defines many functions that are usable on all lists.
The most useful ones are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>add</code>, which adds one element to the end of the list (increasing its size by
one)</p>
</li>
<li>
<p><code>size</code>, which returns the current length of the list</p>
</li>
<li>
<p><code>get</code>, which gets the element at the specified position in the list</p>
</li>
<li>
<p><code>remove</code>, which removes an element from the list (decreasing its size by one)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">System.out.println(names.size()); // Prints 0 - the list is empty initially
names.add(&quot;Chuchu&quot;);
System.out.println(names.size()); // Prints 1 - now the list has one element
names.add(&quot;Xyz&quot;);
System.out.println(names.size()); // Prints 2 - now the list has two elements
System.out.println(names.get(0)); // Prints &quot;Chuchu&quot;, the first element in the list
names.remove(&quot;Chuchu&quot;);
System.out.println(names.get(0)); // Prints &quot;Xyz&quot;, the first element now that Chuchu was removed
System.out.println(names.size()); // Prints 1 - the list has one element anymore</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lists can be iterated over with the enhanced for loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">for (String name : names) {
    // Do something with name?
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Types like <code>List</code> and <code>ArrayList</code> will need to be imported before you can use
them.
Android Studio can help with this.
If you press Tab to autocomplete a type name, any needed import statement will
automatically be added at the top of the file.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="gson"></a><h3>3.2. Writing JSON with Gson</h3>
<div class="paragraph">
<p>In Checkpoint 2, you
<a href="/MP/2/#_using_gson">used Gson to read data</a>
from parsed JSON.
In this checkpoint, you&#x2019;ll need to create JSON objects to send to the server.</p>
</div>
<div class="paragraph">
<p>Gson can help with this too.
To create a new JSON object, use <code>new JsonObject()</code>.
To add a single, simple value like a string or number as a property on an
object, call the object&#x2019;s <code>addProperty</code> function, passing the property name and
value.
For example, this code builds a <code>JsonObject</code> corresponding to
<a href="/MP/2/#_what_is_json">the first MP2 JSON example</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">JsonObject point = new JsonObject();
point.addProperty(&quot;latitude&quot;, 40.109187);
point.addProperty(&quot;longitude&quot;, -88.227213);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To add a more complicated value like an array or other object as a property of
an object, use <code>add</code> instead.</p>
</div>
<div class="paragraph">
<p>Likewise, to create a JSON array, use <code>new JsonArray()</code>.
Its <code>add</code> function will add an entry to the end of the array.</p>
</div>
<div class="paragraph">
<p>This code reconstitutes the more complicated JSON object from the MP2 writeup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">JsonObject cs125 = new JsonObject();
cs125.addProperty(&quot;name&quot;, &quot;CS 125&quot;);
cs125.addProperty(&quot;enrollment&quot;, 800);

JsonObject location = new JsonObject();
location.addProperty(&quot;name&quot;, &quot;Foellinger Auditorium&quot;);
location.addProperty(&quot;allows_food&quot;, false);
location.addProperty(&quot;latitude&quot;, 40.105952);
location.addProperty(&quot;longitude&quot;, -88.227204);
cs125.add(&quot;location&quot;, location);

JsonArray lectureDays = new JsonArray();
lectureDays.add(&quot;Monday&quot;);
lectureDays.add(&quot;Wednesday&quot;);
lectureDays.add(&quot;Friday&quot;);
cs125.add(&quot;lecture_days&quot;, lectureDays);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gson objects stringify to the JSON text they represent, so you can pass them to
<code>System.out.println</code> to see what JSON you&#x2019;ve built.
It will be condensed onto one line and difficult to read, so you may find it
helpful to paste that into
<a href="https://jsonformatter.org/json-pretty-print" target="_blank" class="external">a JSON formatter</a>
to see its structure more easily.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="api"></a><h3>3.3. Our API Documentation</h3>
<div class="paragraph">
<p>To create a multiplayer game, the app makes a POST request to our
<code>/games/create</code> endpoint.
Since there is a lot of game information rather than just a game ID, the game
configuration will need to be uploaded to the server as the body (<em>payload</em>) of
the request.
The body will be a JSON object (Gson <code>JsonObject</code> instance) with these
properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mode</code> (string) is the game mode, either &quot;target&quot; or &quot;area&quot;</p>
</li>
<li>
<p><code>invitees</code> (array of objects) is the list of players invited to the game,
including the user. Each object should have these properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>email</code> (string) is the invitee&#x2019;s email address</p>
</li>
<li>
<p><code>team</code> (integer) is the <code>TeamID</code> code for the role/team the user is invited to</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>For target mode only</em>, <code>proximityThreshold</code> (integer) is the proximity
threshold in meters</p>
</li>
<li>
<p><em>For target mode only</em>, <code>targets</code> (array of objects) is the list of targets in
the game. Each object should have these properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>latitude</code> (double) is the latitude of the target</p>
</li>
<li>
<p><code>longitude</code> (double) is the longitude of the target</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>For area mode only</em>, <code>cellSize</code> (integer) is the cell size in meters</p>
</li>
<li>
<p><em>For area mode only</em>, <code>areaNorth</code>, <code>areaEast</code>, <code>areaSouth</code>, and <code>areaWest</code>
(all doubles) are the latitude/longitude bounds of the area</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may find the
<strong><a href="/MP/files/MP3/target.json">example target mode body</a></strong> and
<strong><a href="/MP/files/MP3/area.json">example area mode body</a></strong> helpful.</p>
</div>
<div class="paragraph">
<p>If the game is created successfully, the server&#x2019;s response will be a JSON object
with a single <code>game</code> property whose value is the (string) game ID.
Our provided code uses this to launch <code>GameActivity</code>.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="presets_api"></a><h3>3.4. Extra Credit API Documentation</h3>
<div class="paragraph">
<p>If you are attempting the extra credit feature to allow the user to load a
predefined set of targets, your app will need to be able to fetch the preset
targets lists from the server.
Those are accessible by a GET request to the <code>/presets</code> endpoint.
The server&#x2019;s response will be a JSON object containing this property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>presets</code> (array of objects) is the list of preset options. Each object has
these properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>name</code> (string) is the human-readable name of the preset</p>
</li>
<li>
<p><code>targets</code> (array of objects) is the list of targets in the preset. Each has at
least these properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>latitude</code> (double) is the target&#x2019;s latitude</p>
</li>
<li>
<p><code>longitude</code> (double) is the target&#x2019;s longitude</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may find
<a href="/MP/files/MP3/presets.json">this example response</a>
helpful.
Do not assume that the <code>note</code> property will always be present on target objects,
but feel free to do anything you like with it if it&#x2019;s there.
You can always ignore it completely.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="git_revert"></a><h3>3.5. Reverting Changes with Git</h3>
<div class="row justify-content-center mt-3 mb-3">
  <div class="col-12 col-lg-8">
    <div class="embed-responsive embed-responsive-4by3">
      <div class="lazyiframe" data-attribs="%7B%22class%22:%22embed-responsive-item%22,%22width%22:%22560%22,%22height%22:%22315%22,%22src%22:%22//www.youtube.com/embed/FQBTwwFX0I8%22,%22allowfullscreen%22:%22%22%7D"></div>
    </div>
  </div>
</div>
<div class="paragraph">
<p>Version control systems like Git make it possible to retrieve older versions of
your code, which is very useful if you accidentally damage a file.
Android Studio integrates with Git to allow you to undo (<em>revert</em>) changes with
its UI.</p>
</div>
<div class="paragraph">
<p>If you would like to put a file back to how it was at the last commit,
right-click it in the Project pane and choose <em>Git | Revert</em>.
This brings up the Revert Changes dialog, where you can select any additional
files you would like to revert.
Reverting a file throws away all changes to it since the last commit and <strong>is
usually not reversible</strong>.</p>
</div>
<div class="paragraph">
<p>For a more surgical approach, Android Studio highlights changed regions of files
with colored bars or gray triangles in the left margin of the code editor.
Clicking one of these decorations produces a toolbar with a back arrow (Rollback
Lines) button that reverts just the highlighted lines to how they were in the
last commit.
This rollback method may sometimes be reversible with Ctrl+Z, but you should
still be certain that you want to throw away your changes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="goal"></a><h2>4. Your Goal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you&#x2019;re done with Checkpoint 3, creating a game will upload its
configuration to the server and make it visible to the invitees, who can then
accept or decline the invitation using their app.
The game setup activity will show only the settings for the selected game mode.</p>
</div>
<div class="row justify-content-center mt-3 mb-3">
  <div class="col-12 col-lg-8">
    <div class="embed-responsive embed-responsive-4by3">
      <div class="lazyiframe" data-attribs="%7B%22class%22:%22embed-responsive-item%22,%22width%22:%22560%22,%22height%22:%22315%22,%22src%22:%22//www.youtube.com/embed/5ktxAUwjVpM%22,%22allowfullscreen%22:%22%22%7D"></div>
    </div>
  </div>
</div>
<div class="sect2">
<a class="anchor" id="target"></a><h3>4.1. The <code>Target</code> Class</h3>
<div class="paragraph">
<p>The new test suite, <code>Checkpoint3Test</code>, is initially unable to compile because it
refers to a <code>Target</code> class in the <code>logic</code> subdirectory that does not <em>yet</em>
exist, so this must be fixed first.
We will be using the <code>Target</code> class primarily in the next checkpoint to help
manage a target marker on the map, since the Checkpoint 0 approach of passing
coordinates to a <code>changeMarkerColor</code> function is unwieldy
<span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;and somewhat error-prone, as some noticed during MP0&lt;/body&gt;&lt;/html&gt;">1</span>.</p>
</div>
<div class="paragraph">
<p>Create the class by right-clicking the <code>logic</code> subfolder within the package,
choosing <em>New | Java Class</em>, entering <code>Target</code> in the Name field, and clicking
OK.
We also expect a <code>GameSetup</code> logic class, described in the next section, that
you will need to similarly create before your code can compile.
You don&#x2019;t need to <em>implement</em> all the functionality at once, but you should
create functions to match the Javadoc so you can get the tests running.</p>
</div>
<div class="openblock alert alert-warning">
<div class="content">
<div class="paragraph">
<p>Be sure that the files were created inside the <code>logic</code> subpackage and that they
were added to Git.
If they are not, your code may not be seen during official grading.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>To see the needed public members of this class</strong>, refer to
<a href="https://cs125-illinois.github.io/Spring2020-MP-Writeups/3/edu/illinois/cs/cs125/spring2020/mp/logic/Target.html" target="_blank" class="external">our official Javadoc</a>.
You will need to store a Google Maps
<a href="https://developers.google.com/android/reference/com/google/android/gms/maps/model/Marker.html" target="_blank" class="external"><code>Marker</code></a>
object in a private instance variable.</p>
</div>
<div class="paragraph">
<p>To place a marker on a Google map, use the map&#x2019;s <code>addMarker</code> function
<span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;like the provided &lt;code&gt;placeMarker&lt;/code&gt; function in &lt;code&gt;GameActivity&lt;/code&gt; does&lt;/body&gt;&lt;/html&gt;">2</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">// Suppose position is a LatLng variable
MarkerOptions options = new MarkerOptions().position(position);
// Set any other options you like?
Marker marker = map.addMarker(options);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To change the color of a marker after it has been created, use its <code>setIcon</code>
function
<span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;like &lt;code&gt;changeMarkerColor&lt;/code&gt; in &lt;code&gt;GameActivity&lt;/code&gt; does&lt;/body&gt;&lt;/html&gt;">3</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">// Suppose hue is a hue value like the constants defined on BitmapDescriptorFactory
BitmapDescriptor icon = BitmapDescriptorFactory.defaultMarker(hue);
marker.setIcon(icon);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can refer to
<a href="https://developers.google.com/android/reference/com/google/android/gms/maps/model/BitmapDescriptorFactory" target="_blank" class="external">this Android article</a>
to check out the different <code>HUE_</code> constants to use in <code>Target.java</code>.</p>
</div>
<div class="paragraph">
<p>After completing this task, <code>testTargetClass</code> will pass.
You may <em>optionally</em> rework your target mode logic in <code>GameActivity</code> to take
advantage of this new class, but otherwise you will not need it again in this
checkpoint.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="latlng"></a><h3>4.2. <code>LatLng</code> Refactor</h3>
<div class="paragraph">
<p>Functions that take eight parameters, especially all of the same type, can be
difficult to use.
This is even more unfortunate when some of the parameters really belong
together, packaged up into objects.
Now that you know how to use objects like the Google Maps SDK&#x2019;s <code>LatLng</code>, we&#x2019;ve
rewritten <code>LinesCrossDetector.linesCross</code> to accept the lines&apos; endpoints as
<code>LatLng</code> objects
<span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;In fact, &lt;code&gt;checkstyle&lt;/code&gt;&amp;apos;s default configuration forbids functions with more than seven parameters. We had to change that to allow our original version of this function.&lt;/body&gt;&lt;/html&gt;">4</span>.</p>
</div>
<div class="paragraph">
<p>You need to copy the new version from
<a href="https://gist.github.com/Fleex255/d11e2d1344b5a7a52ec8dd6941d0e2f5" target="_blank" class="external">this GitHub
Gist</a>
over your current <code>LineCrossDetector</code> so that <code>linesCross</code> can be called with
four <code>LatLng</code> positions.
You will also need to update the places in your code that call it to match.</p>
</div>
<div class="paragraph">
<p>Similarly refactor the <code>addLine</code> function in <code>GameActivity</code> to take two <code>LatLng</code>
endpoints rather than four <code>double</code> coordinates.
You will need to update the function&#x2019;s callers to be compatible with its new
signature.
Once you complete these tasks, <code>testLatLngRefactor</code> will pass.</p>
</div>
<div class="paragraph">
<p>If you make a mistake while refactoring and want to put a file back to how it was
at the last commit, see the section on <a href="#git_revert">reverting changes</a>.</p>
</div>
<div class="sect3">
<a class="anchor" id="_optional_refactoring_targetvisitchecker"></a><h4>4.2.1. Optional: Refactoring <code>TargetVisitChecker</code></h4>
<div class="paragraph">
<p>If you would like to, you may refactor your <code>TargetVisitChecker</code> methods to take
a <code>LatLng[]</code> in place of the two <code>double[]</code>s.
<a href="https://cs125-illinois.github.io/Spring2020-MP-Writeups/3/edu/illinois/cs/cs125/spring2020/mp/logic/TargetVisitChecker.html" target="_blank" class="external">Updated Javadoc</a> is available.
The Checkpoint 0 tests are forward-compatible with this change.
After doing that, you&#x2019;ll probably want to use the <code>getPositions</code> function of
<code>DefaultTargets</code> rather than <code>getLatitudes</code> and <code>getLongitudes</code> in your
<code>GameActivity</code> target mode setup.</p>
</div>
<div class="paragraph">
<p>Better yet, you may take advantage of your new list skills to keep track of the
target mode game state entirely inside <code>GameActivity</code>.
If <code>TargetVisitChecker</code> is removed, the Checkpoint 0 test results will be
all-or-nothing based on the result of <code>testTargetModeGameplay</code>.</p>
</div>
<div class="paragraph">
<p><code>TargetVisitChecker</code> will be removed entirely in the next checkpoint and
<code>GameActivity</code> will be significantly remodeled then, so don&#x2019;t get too attached
to either.</p>
</div>
<div class="paragraph">
<p>This section of refactoring is <strong>not required and will not be graded</strong>, but it
is encouraged to practice changing your code, as it is a necessary real-world
skill!</p>
</div>
</div>
</div>
<div class="sect2">
<a class="anchor" id="game_setup"></a><h3>4.3. The <code>GameSetup</code> Class</h3>
<div class="paragraph">
<p>You will need to create a <code>GameSetup</code> class in the <code>logic</code> subfolder.
This class will contain two static helper methods that take the app&#x2019;s current
game information and convert all the data into a JSON payload that can be sent
in a POST request.</p>
</div>
<div class="paragraph">
<p>Remember to follow the documentation for <a href="#api">our API</a> so
that when you write properties and values into your <code>JsonObject</code>, they match the
naming and type conventions that we&#x2019;ve specified.
Some of the parameters passed to your functions are <code>List</code>s.
You will need to read from them according to <a href="#lists">our list introduction</a>
but should not need to modify them or create new lists here.</p>
</div>
<div class="paragraph">
<p>You can refer to the Javadoc for the class
<a href="https://cs125-illinois.github.io/Spring2020-MP-Writeups/3/edu/illinois/cs/cs125/spring2020/mp/logic/GameSetup.html" target="_blank" class="external">here</a>.
Be sure to implement both listed functions, but you are encouraged to add helper
functions as you design your logic.</p>
</div>
<div class="paragraph">
<p>Once the functions are fully implemented, <code>GameSetup</code> will be able to create
JSON objects representing the configuration of a multiplayer target game or area
game.
<code>testJsonTargetMode</code> and <code>testJsonAreaMode</code> respectively will then pass.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="_game_setup_ui"></a><h3>4.4. Game Setup UI</h3>
<div class="paragraph">
<p>The game configuration screen allows the user to select their desired game mode
(area or target) and set other parameters like the cell size or proximity
threshold.
This screen&#x2019;s layout is <code>activity_new_game.xml</code> and its Java class is
<code>NewGameActivity</code>.</p>
</div>
<div class="paragraph">
<p>Our layout contains a <code>RadioGroup</code> with ID <code>gameModeGroup</code>.
Inside this <code>RadioGroup</code> are two <code>RadioButton</code>s.
One has ID <code>targetModeOption</code> and the other has ID <code>areaModeOption</code>.
The user will use these to pick the game mode.</p>
</div>
<div class="paragraph">
<p>Some settings only make sense for one game mode, so they shouldn&#x2019;t be shown all
the time.
For example, the user shouldn&#x2019;t see a setting for proximity threshold when
setting up an area mode game.
To allow showing and hiding the different game-mode-specific settings as a unit,
we&#x2019;ve organized the views into containers.
There is a <code>LinearLayout</code> with the ID <code>areaSettings</code>.
If the user chooses to play a game in target mode, this <code>LinearLayout</code> should
disappear.
Otherwise, the user will use this settings container to configure their game.
For target mode settings, we&#x2019;ve added another container with ID
<code>targetSettings</code>.</p>
</div>
<div class="paragraph">
<p>To make the radio buttons change the containers&apos; visibility, we need to add code
to <code>NewGameActivity</code>.
In <code>onCreate</code>, attach a handler that will be run when the selected radio button
in the <code>RadioGroup</code> is changed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">// Suppose modeGroup is a RadioGroup variable (maybe an instance variable?)
modeGroup = findViewById(R.id.gameModeGroup);
modeGroup.setOnCheckedChangeListener((unused, checkedId) -&gt; {
    // checkedId is the R.id constant of the currently checked RadioButton
    // Your code here: make only the selected mode&apos;s settings group visible
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each mode&#x2019;s settings group should be shown only when its option is selected.
Each settings group should be <code>View.GONE</code> initially and when its mode is not
selected.
After you make this so, <code>testSettingsGroupVisibility</code> will pass.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="presets"></a><h3>4.5. Extra Credit: Target Presets</h3>
<div class="paragraph">
<p><strong>Challenge problem!</strong>
This is extra credit because it takes a bit more work and tinkering.
It can be done before the game creation API request and before you complete the
<code>RadioGroup</code> visibility modifications, so feel free to tackle this early on!</p>
</div>
<div class="paragraph">
<p>Many users won&#x2019;t want to spend a lot of time picking out enough targets for an
interesting target mode game.
To make it easier to add a set of targets, the app could have several suggested
lists of targets and allow the user to add an entire suggested list at once.</p>
</div>
<div class="paragraph">
<p>Inside the target mode settings group, we have added a &quot;Load Preset&quot; with ID
<code>loadPresetTargets</code>.
When it is clicked, you need to fetch the <a href="#presets_api">list of presets from
the server</a>.
When the request completes, create and show an <code>AlertDialog</code> to list the
options.
Refer to Android&#x2019;s
<a href="https://developer.android.com/guide/topics/ui/dialogs.html#AlertDialog" target="_blank" class="external"><code>AlertDialog</code>
guide</a>
for details.</p>
</div>
<div class="paragraph">
<p>We have provided a <code>chunk_presets_list.xml</code> layout resource which you can inflate
<span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;like the provided code in Checkpoint 2 did with the game information chunks&lt;/body&gt;&lt;/html&gt;">5</span>
<em>with a null parent</em>
<span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;Android Studio will warn about that, but it&amp;#x2019;s OK&amp;#x2014;this is the one place in Android where it&amp;#x2019;s acceptable and necessary to pass a null root.&lt;/body&gt;&lt;/html&gt;">6</span>
and pass to the dialog builder&#x2019;s <code>setView</code> function.
For each preset option, add a <code>RadioButton</code>
inside the provided <code>RadioGroup</code> (ID <code>presetOptions</code>), with the radio button&#x2019;s text set to the
preset&#x2019;s name.
This is the one place in the MP where you should create an individual view
dynamically using <code>new</code>.
The constructors for most Android views take a context, which can be
the activity: <code>this</code> <span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;or &lt;code&gt;NewGameActivity.this&lt;/code&gt; if inside a non-concise handler&lt;/body&gt;&lt;/html&gt;">7</span>.</p>
</div>
<div class="paragraph">
<p>The alert dialog&#x2019;s positive button should be labeled &quot;Load&quot;.
Its negative button should be labeled &quot;Cancel.&quot;
The dialog might look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/MP/images/MP3/LoadPreset.png" alt="a list of preset options">
</div>
</div>
<div class="paragraph">
<p>If the positive button (Load) is pressed with a preset selected, all existing
targets should be removed and all the targets from the selected preset should be
added.
There are multiple ways to associate a preset with a radio button&#x2014;you may
find <code>getTag</code> and <code>setTag</code> helpful.
If the user presses Cancel or presses Load without selecting a preset, do
nothing and the dialog will be dismissed by default.</p>
</div>
<div class="paragraph">
<p>If you complete this task, <code>testTargetPresets_extraCredit</code> will pass and you&#x2019;ll
have earned 20% extra credit!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="grading"></a><h2>5. Grading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As always, 100 points is full credit on the checkpoint.
But on MP3 there are <strong>120</strong> points available, broken down as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>15 points</strong> for the <code>Target</code> class</p>
</li>
<li>
<p><strong>15 points</strong> for refactoring <code>addLine</code> and <code>LineCrossDetector</code></p>
</li>
<li>
<p><strong>10 points</strong> for making the radio buttons in <code>NewGameActivity</code> control
settings group visibility</p>
</li>
<li>
<p><strong>25 points</strong> for <code>areaMode</code> in <code>GameSetup</code></p>
</li>
<li>
<p><strong>25 points</strong> for <code>targetMode</code> in <code>GameSetup</code></p>
</li>
<li>
<p><strong>20 points</strong> of <em>extra credit</em> for the <em>optional</em> Load Preset feature</p>
</li>
<li>
<p><strong>10 points</strong> for passing <code>checkstyle</code> inspection</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you missed a deadline in a previous checkpoint, doing the extra credit here
is a great way to earn some of those points back!</p>
</div>
<div class="paragraph">
<p>Your app will be tested by <code>Checkpoint3Test</code>.
Feel free to look through that class&#x2019;s code to see what the test suite tries to
do with your app.
Post on the <a href="https://cs125-forum.cs.illinois.edu/c/spring2020-mp/mp3/102" class="noexternal">forum</a> for clarifications about what exactly is expected.</p>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_cliffhanger"></a><h2>6. Cliffhanger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Because the game setup screen submits the game configuration to the server
instead of passing it to the game activity, gameplay is probably pretty broken
at the moment.
In the next and final checkpoint, we&#x2019;ll finish the app by connecting the game
activity to the server!</p>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_cheating"></a><h2>7. Cheating</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By now you should be familiar with the
<a href="https://cs125.cs.illinois.edu/info/syllabus/#cheating" target="_blank" class="external">cheating policies</a> from
the syllabus.
Collaborating in a human language about how to approach the problems is
encouraged, but sharing your code with anyone not currently on the course staff
constitutes cheating.</p>
</div>
</div>
</div>

    </main>
  </div>
</div>

<div class="container hidden-print">
  <div class="row" style="margin-top: 10px; margin-bottom: 20px;">
    <div class="col-xs-12">
      <hr>
    </div>
    <div class="small col-xs-12 col-md-4 col-md-offset-4 text-center">
      Created 10/24/2021 <br>
      Updated 10/24/2021
    </div>
    <div class="small col-xs-12 col-md-4 text-center">
      <a class="link_exception external" href="https://github.com/cs125-illinois/www/commit/757182888eb7ea986f2788b840e32ee4da2480f8" target="_blank">Commit <code>7571828</code></a>
      //
      <a class="link_exception external" href="https://github.com/cs125-illinois/www/commits/master/src/MP/3.adoc" target="_blank">History</a> //
      <a class="link_exception external" href="https://github.com/cs125-illinois/www/blob/master/src/MP/3.adoc" target="_blank">View</a>
      <br>
      Built 10/24/2021 @ 20:55 EDT
    </div>
  </div>
</div>

<script src="/static-assets/highlight.c2ac4dbbbfbaa664d982.js"></script>







</body></html><!--
  vim: et:ts=2:sw=2:ft=html
--><!--
  vim: et:ts=2:sw=2:ft=html
-->