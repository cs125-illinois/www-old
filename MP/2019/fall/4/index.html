<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<title>MP4: Polymorphism</title>
		<meta name="description" lang="en-us" content="MP4 demonstrates refactoring and polymorphism, and finishes the app by connecting gameplay to the game server.">
    <meta name="google-site-verification" content="y_Y-3Qy2OkNZGt3FSNhmY31PkAtFbaTGrDKrSZffbvE">

      <link rel="stylesheet" href="/static-assets/site.ce01e59baf542a8794f1.css">

      <script src="/static-assets/site.ce01e59baf542a8794f1.js" async></script>

		<link rel="icon" type="image/png" sizes="228x228" href="/img/favicon/coast-228x228.png">
		<link rel="yandex-tableau-widget" href="/img/favicon/yandex-browser-manifest.json">
		<link rel="apple-touch-icon" sizes="57x57" href="/img/favicon/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/img/favicon/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/img/favicon/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/img/favicon/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/img/favicon/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/img/favicon/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/img/favicon/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/img/favicon/apple-touch-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon-180x180.png">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta name="apple-mobile-web-app-title" content="CS 125">
		<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
		<link rel="shortcut icon" href="/img/favicon/favicon.ico">
		<link rel="manifest" href="/img/favicon/manifest.json">
		<meta name="mobile-web-app-capable" content="yes">
		<meta name="theme-color" content="#fff">
		<meta name="application-name" content="CS 125">
		<meta name="msapplication-TileColor" content="#fff">
		<meta name="msapplication-TileImage" content="/img/favicon/mstile-144x144.png">
		<meta name="msapplication-config" content="/img/favicon/browserconfig.xml">
		
    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js" defer></script>

    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-45109275-2', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
    <script>
      if (window.location.hostname === 'localhost') {
        window['ga-disable-UA-45109275-2'] = true
      }
    </script>
  </head>

  <body data-spy="scroll" data-target="#toc">
    <div id="navbarTop" class="fixed-top">
      <nav class="navbar navbar-expand navbar-light bg-white pb-2 flex-column flex-md-row">
        <a class="navbar-brand" href="/">
          <img src="/img/logos/cs125-wide-157x60.png" width="157" height="60" data-pagespeed-no-transform="true" class="d-none d-lg-inline-block align-top" alt="CS 125: Introduction to Computer Science">
          <img src="/img/logos/cs125-60x60.png" width="46" height="46" data-pagespeed-no-transform="true" class="d-inline-block d-lg-none align-top" alt="CS 125: Introduction to Computer Science">
        </a>
        <button id="sidebar-button" type="button" data-toggle="collapse" data-target="#sidebar" aria-controls="sidebar" aria-expanded="false" aria-label="Toggle navigation" class="d-block d-md-none" style="position: fixed; top: 20px; right: 20px;">
          <span class="navbar-toggler-icon"></span>
        </button>
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="/info/syllabus/">Info</a>
          </li>
          <li class="nav-item">
            <a class="nav-link noexternal" href="https://cs125-forum.cs.illinois.edu">Forum</a>
          </li>
          <li class="nav-item">
            <a class="nav-link noexternal" href="https://cs125-help.cs.illinois.edu">Help</a>
          </li>
          <!--
          <li class="nav-item">
            <a class="nav-link"
               href="/info/fair/"
               data-active="^info/fair"><strong>Fair</strong></a>
          </li>
          <li class="nav-item">
            <a class="nav-link"
               href="/info/join/"
               data-active="^(?!info/join)info">Join</a>
          </li>
          -->
          <li class="nav-item">
            <a class="nav-link" href="/learn/">Learn</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/info/people/">People</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" data-redirect="/MP" href="/MP/5/">MPs<span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-redirect="/lab" href="/lab/14/">Labs</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/m/grades/">Grades</a>
          </li>
        </ul>
        <ul class="navbar-nav ml-auto mr-2">
          <li id="login" class="d-flex mr-2 mr-xl-3"></li>
          <li class="d-none d-md-flex nav-item mr-2 mr-xl-3">
            <a href="//www.youtube.com/channel/UC8L44j0A6LAlC4FM8IiNx-w/videos" target="_blank" class="noexternal"><i class="fa fa-youtube-play fa-2x navbar-icon" aria-hidden="true"></i></a>
          </li>
          <li class="d-none d-md-flex nav-item">
            <a href="//github.com/cs125-illinois" target="_blank" class="noexternal"><i class="fa fa-github fa-2x navbar-icon" aria-hidden="true"></i></a>
          </li>
        </ul>
      </nav>
      <div class="fadeout"></div>
    </div>
    
    <!--
      vim: et:ts=2:sw=2:ft=html
    -->

<!--
  vim: et:ts=2:sw=2:ft=html
-->

<div id="content" class="container-fluid">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 sidebar">
      <div id="sidebar" class="collapse">
        <nav class="nav flex-column">
          <ul class="section-nav">
            <li class="entry">
              <strong>Fall 2019</strong>
            </li>
            <li>
              <a href="/MP/2019/fall/5/">MP5</a>
            </li>
            <li>
              <a href="/MP/2019/fall/4/" class="active" onclick="return false;">MP4<span class="sr-only">(current)</span></a>
            </li>
            <li>
              <a href="/MP/2019/fall/3/">MP3</a>
            </li>
            <li>
              <a href="/MP/2019/fall/2/">MP2</a>
            </li>
            <li>
              <a href="/MP/2019/fall/1/">MP1</a>
            </li>
            <li>
              <a href="/MP/2019/fall/0/">MP0</a>
            </li>
            <li>
              <span data-active="^MP/2019/fall/setup" class="option">Setup</span>
              <ul>
                <li>
                  <a href="/MP/2019/fall/setup/android-studio/">Android Studio</a>
                </li>
                <li>
                  <a href="/MP/2019/fall/setup/git/">Git</a>
                </li>
              </ul>
            </li>
            <li>
              <strong><a href="/MP/">Return to Current MPs</a></strong>
            </li>
          </ul>
          
          <!--
            vim: et:ts=2:sw=2:ft=html
          -->
        </nav>
        <div class="fadeout"></div>
      </div>
    </div>
    <div class="col-md-3 col-xl-2" style="z-index: -1;"></div>

    <div class="col-xl-3 d-none d-xl-block toc">
      <nav id="toc" class="nav flex-column">
        <ul class="section-nav">
          <li class="entry">
            <a class="nav-link" href="#top">1. Learning Objectives</a>
          </li>
          <li class="entry">
            <a class="nav-link" href="#_assignment_structure">2. Assignment Structure</a>
            <ul>
              <li><a class="nav-link" href="#obtaining">2.1. Obtaining MP4</a></li>
              <li><a class="nav-link" href="#_late_submissions">2.2. Late Submissions</a></li>
            </ul>
          </li>
          <li class="entry">
            <a class="nav-link" href="#tools">3. Tools and Resources</a>
            <ul>
              <li><a class="nav-link" href="#maps">3.1. Maps</a></li>
              <li><a class="nav-link" href="#websockets">3.2. What is a Websocket?</a></li>
              <li><a class="nav-link" href="#servermessages">3.3. Messages We Send</a></li>
              <li><a class="nav-link" href="#clientmessages">3.4. Messages You Send</a></li>
            </ul>
          </li>
          <li class="entry">
            <a class="nav-link" href="#goal">4. Your Goal</a>
            <ul>
              <li><a class="nav-link" href="#connectwebsocket">4.1. Connecting</a></li>
              <li><a class="nav-link" href="#gamestate">4.2. Game State</a></li>
              <li><a class="nav-link" href="#subclasses">4.3. Using Game Subclasses</a></li>
              <li><a class="nav-link" href="#targetmode">4.4. Target Mode Gameplay</a></li>
              <li><a class="nav-link" href="#areamode">4.5. Area Mode Gameplay</a></li>
              <li><a class="nav-link" href="#scoring">4.6. Scoring</a></li>
              <li><a class="nav-link" href="#gameover">4.7. Game Over</a></li>
            </ul>
          </li>
          <li class="entry">
            <a class="nav-link" href="#grading">5. Grading</a>
          </li>
          <li class="entry">
            <a class="nav-link" href="#cheating">6. Cheating</a>
          </li>
          <li class="entry">
            <a class="nav-link" href="#epilogue">7. Epilogue</a>
          </li>
        </ul>
      </nav>
    </div>

    <main class="col-12 col-md-9 col-xl-7 py-3">

      <div id="outdated" class="alert alert-danger" role="alert">
        <h4 class="alert-heading">Warning: Outdated Content</h4>
        <p>This MP is from a previous version of CS 125.
          <a href="/mp/">Click here</a> to access the latest
          version.
        </p>
      </div>

      <a class="anchor" id="top"></a>
        <h1>MP4: Polymorphism</h1>
      <div class="paragraph lead">
<p>In <a href="/MP/2019/fall/3">MP3</a> you made it possible to create multiplayer games.
In this final checkpoint you&#x2019;ll finish the app by connecting gameplay to the server.</p>
</div>
<div class="paragraph">
<p>In <a href="/MP/2019/fall/0">MP0</a> and <a href="/MP/2019/fall/1">MP1</a> you implemented singleplayer, local gameplay for target
mode and area mode by writing code directly in the game activity. Now it&#x2019;s time to expand
that logic to work with multiplayer games, where data about other players is coming in from
the server and data about the user needs to be sent to the server.</p>
</div>
<div class="paragraph">
<p>In lecture, you learned about <em>polymorphism</em>, which makes it easier to share behavior between
classes. To manage the complexity of multiplayer gameplay logic, you will apply polymorphism
to create a class to manage each kind of game. You will organize the codebase and consolidate
related logic by refactoring the gameplay logic out of the game activity and into those new
classes.</p>
</div>
<div class="paragraph">
<p>A screencast with an overview of the checkpoint is available <span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;planned by the CA captains, narrated by Daniel&lt;/body&gt;&lt;/html&gt;">1</span>:</p>
</div>
<div class="row justify-content-center mt-3 mb-3">
  <div class="col-12 col-lg-8">
    <div class="embed-responsive embed-responsive-4by3">
      <div class="lazyiframe" data-attribs="%7B%22class%22:%22embed-responsive-item%22,%22width%22:%22560%22,%22height%22:%22315%22,%22src%22:%22//www.youtube.com/embed/oN6CZT5Sf3M%22,%22allowfullscreen%22:%22%22%7D"></div>
    </div>
  </div>
</div>
<div class="paragraph">
<p>Please note that the organization of the Your Goal section was improved since the recording,
so section numbers and ordering will not match exactly.</p>
</div>
<div class="paragraph">
<p>As usual, deadlines vary based on your deadline group. MP4 is due at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>8 PM on Sunday, 11/17/2019 for the Blue Group</strong>: all labs starting at 2 PM or earlier</p>
</li>
<li>
<p><strong>8 PM on Monday, 11/18/2019 for the Orange Group</strong>: all labs starting at 3 PM or later</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, 10% of your grade is for submitting code that earns at least <em>40 points</em>
by 8 PM on <strong>Sunday 11/10/2019 (Blue)</strong> or <strong>Monday 11/11/2019 (Orange)</strong>.
Late submissions are subject to the <a href="/info/2019/fall/syllabus/#regrading">MP late submission policy</a>.</p>
</div>
<div class="sect1">
<a class="anchor" id="_learning_objectives"></a><h2>1. Learning Objectives</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Checkpoint 4 you will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Organize your codebase using polymorphism</p>
</li>
<li>
<p>Generalize your existing algorithms to more complex cases</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will also continue to exercise skills used previously, especially object-oriented programming
fundamentals and refactoring.</p>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_assignment_structure"></a><h2>2. Assignment Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://cs125-illinois.github.io/Fall2019-MP-Writeups/4/edu/illinois/cs/cs125/fall2019/mp/package-summary.html" target="_blank" class="external"><strong>Updated Javadoc</strong></a>
is available.</p>
</div>
<div class="paragraph">
<p>As usual, we distribute the Checkpoint 4 updates in a patch.
Since this patch includes changes to the <code>main</code> source set like Checkpoint 3 did,
<strong>an extra step is needed</strong> to ensure the changes are committed with the rest of your work.</p>
</div>
<div class="sect2">
<a class="anchor" id="obtaining"></a><h3>2.1. Obtaining MP4</h3>
<div class="paragraph">
<p>To apply the patch, follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that all your work is committed, so that none of your files&apos; names appear green or blue
in the Project pane.</p>
</li>
<li>
<p>Download <a href="/MP/2019/fall/patches/MP4.patch">the MP4 patch file</a>.</p>
</li>
<li>
<p>In Android Studio, select the <em>VCS | Apply Patch</em> menu item.</p>
</li>
<li>
<p>Select the downloaded patch.</p>
</li>
<li>
<p>Change the Name dropdown to <strong>Default Changelist</strong>. <span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;This makes Android Studio include the updates in commits made normally by the commit dialog.&lt;/body&gt;&lt;/html&gt;">2</span></p>
</li>
<li>
<p>Press OK to apply the patch.</p>
</li>
<li>
<p>Change the <code>checkpoint</code> setting in <code>grade.yaml</code> to <code>4</code>.</p>
</li>
<li>
<p>Select the <em>File | Sync Project with Gradle Files</em> menu item.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We also provide much of an updated <code>GameActivity</code> file, but you will need to <strong>apply it separately</strong>
because a patch would likely not be compatible with previous work in that file.
To get that part of the starter code, copy-paste
<strong><a href="https://gist.github.com/Fleex255/3b06f6e2aa4442e0bc68aa1021505a75" target="_blank" class="external">this Gist</a></strong>
over your <code>GameActivity</code>. The work you did in that file is still accessible on GitHub or through
<em>Git | Show History</em>; you will want to refer to your previous code as you refactor that logic
into separate files.</p>
</div>
<div class="openblock alert alert-warning">
<div class="content">
<div class="paragraph">
<p>If the patch didn&#x2019;t apply fully, you may get <strong>compilation errors in the new <code>GameActivity</code></strong>.
Those can be fixed by opening the <code>activity_game.xml</code> layout resource, switching to Text view,
and pasting <a href="https://gist.github.com/Fleex255/9fe8452bb61671c70cfda87cf10cc8af" target="_blank" class="external">this Gist</a> over
the existing contents.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>You can test your Checkpoint 4 work by running the new Test Checkpoint 4 run configuration.
You can run the local autograder with the Grade run configuration.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="_late_submissions"></a><h3>2.2. Late Submissions</h3>
<div class="paragraph">
<p>Like in previous checkpoints, enabling <code>useProvided</code> causes the app to use our provided
components. For Checkpoint 4, the only past components you need are <code>AreaDivider</code> and <code>Target</code>,
but in addition to those we also provide the launch activity, the dashboard/main activity,
and the completed game setup activity so that your app can work. Unlike when using provided
components for working on Checkpoint 3, we do not replace any part of your <code>GameActivity</code>.</p>
</div>
<div class="paragraph">
<p>As always, you can go back and make late submissions to previous checkpoints by changing
<code>checkpoint</code>. Past test suites are forward-compatible with this checkpoint&#x2019;s reorganization.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="tools"></a><h2>3. Tools and Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides background and documentation you will need to achieve
<a href="#goal">Your Goal</a>.</p>
</div>
<div class="sect2">
<a class="anchor" id="maps"></a><h3>3.1. Maps</h3>
<div class="paragraph">
<p>You learned about one of the most common data structures in MP3: the <a href="/MP/2019/fall/3/#lists"><em>list</em></a>,
which stores an ordered variable-length collection of items.
Another extremely useful data structure is the <em>map</em>. Maps store associations between
two kinds of things, allowing a <em>value</em> to be looked up by a <em>key</em>. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>University software might use a map to associate <code>Student</code> objects (values)
with NetID <code>String</code>s (keys).</p>
</li>
<li>
<p>Forum software might look up users&apos; display names (values)
by usernames (keys).</p>
</li>
<li>
<p>A dictionary allows you to look up the definition (value) of a word (key).
<span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;In fact, another common term for &lt;em&gt;map&lt;/em&gt; is &lt;em&gt;dictionary&lt;/em&gt;.&lt;/body&gt;&lt;/html&gt;">3</span></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Java map objects implement the
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html" target="_blank" class="external"><code>Map</code></a> interface.
The most commonly used implementation is
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html" target="_blank" class="external"><code>HashMap</code></a>.</p>
</div>
<div class="paragraph">
<p>Like lists, declaring a map variable involves angle bracket syntax. Since the type of values
in the map can be different from the type of keys, you need to specify the key type and the
value type. For example, this code declares and initializes a map from strings to integers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">Map&lt;String, Integer&gt; capacities = new HashMap&lt;&gt;();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The empty angle brackets on the right side indicates that the actual map created holds the same
kinds of keys and values as the variable is declared to associate.</p>
</div>
<div class="paragraph">
<p>The most commonly useful functions defined by the <code>Map</code> interface are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>put</code>, which takes a key and value, adding or replacing the value associated with that key</p>
</li>
<li>
<p><code>get</code>, which returns the value associated with the given key (or null if the key is absent)</p>
</li>
<li>
<p><code>remove</code>, which removes the association involving the given key</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">capacities.put(&quot;Foellinger&quot;, 2500);
capacities.put(&quot;University Hall&quot;, 1000);
System.out.println(capacities.get(&quot;Foellinger&quot;)); // Prints 2500
capacities.put(&quot;Foellinger&quot;, 1750);
System.out.println(capacities.get(&quot;Foellinger&quot;)); // Now prints 1750
capacities.remove(&quot;University Hall&quot;);
System.out.println(capacities.get(&quot;University Hall&quot;) == null); // Prints true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The associations in a map can be iterated over by using the collection returned by <code>entrySet</code>
with the enhanced for loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">for (Map.Entry&lt;String, Integer&gt; entry : capacities.entrySet()) {
    // The type names in the angle brackets should match the types in the map
    // The current key is entry.getKey()
    // The current value is entry.getValue()
    // Do something with the key and value?
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can get an iterable collection of just the keys with <code>keySet</code>
or of just the values with <code>values</code>.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="websockets"></a><h3>3.2. What is a Websocket?</h3>
<div class="paragraph">
<p>In Checkpoints 2 and 3, you made web requests to get data from or submit data to the server.
HTTP requests work well for one-time requests like we&#x2019;ve done so far, but to continually get the
newest data, the client would have to keep asking the server over and over again, which is
inefficient.</p>
</div>
<div class="paragraph">
<p><em>Websockets</em> allow the client and server to maintain a bidirectional connection.
The client can send additional messages to the server without the overhead of a new request,
and the server can send messages to the client immediately as events occur.</p>
</div>
<div class="paragraph">
<p>The websocket protocol allows any kind of data to be transferred. We will continue to use JSON
objects to represent the messages/updates in the game. So when you need to send an update to
the server, you will build a Gson <code>JsonObject</code> and pass it to our function that sends the JSON
to the server. When the server sends an update to your app, a handler in your code will be called
and passed the <code>JsonObject</code>, which you can <a href="/MP/2019/fall/2/#_using_gson">read data from</a>
like you did in Checkpoint 2.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="servermessages"></a><h3>3.3. Messages We Send</h3>
<div class="paragraph">
<p>This section shows the structure of every message sent by our server. Some of it
is processed by our provided code, but your code is responsible for some parts.</p>
</div>
<div class="paragraph">
<p>Since all websocket messages are turned into <code>JsonObject</code>s by our provided code,
there needs to be some way to tell what kind of update each message is. Our convention for
this app is that <strong>every websocket message has a string <code>type</code> property</strong> specifying what kind of
event it represents.</p>
</div>
<div class="paragraph">
<p>You don&#x2019;t need to and probably don&#x2019;t want to read this kind of dense API documentation
from start to finish. Instead, remember what <em>kind</em> of information this section has and refer
to it when necessary.</p>
</div>
<div class="sect3">
<a class="anchor" id="update_full"></a><h4>3.3.1. <code>full</code></h4>
<div class="paragraph">
<p>When your app enters a game, the first message the server sends to it via the
<a href="#websockets">websocket</a> is a <code>full</code>-type update, which includes everything about the game as
it stands at that moment. That data will be useful for loading the progress already made in the
game. It has these properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>owner</code> (string) is the email of the game&#x2019;s creator/owner</p>
</li>
<li>
<p><code>state</code> (integer) is the <code>GameStateID</code> code for the game state</p>
</li>
<li>
<p><code>mode</code> (string) is the game mode, either &quot;area&quot; or &quot;target&quot;</p>
</li>
<li>
<p><code>players</code> (array) is the list of players involved in or invited to the game, each of which is
an object with these properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>email</code> (string) is the player&#x2019;s email</p>
</li>
<li>
<p><code>team</code> (integer) is the <code>TeamID</code> code for the player&#x2019;s team/role</p>
</li>
<li>
<p><code>state</code> (integer) is the <code>PlayerStateID</code> code for the player</p>
</li>
<li>
<p><code>lastLatitude</code> and <code>lastLongitude</code> (doubles) are the player&#x2019;s last known location,
only present if the player is currently playing the game and their phone has sent a
location update</p>
</li>
<li>
<p><code>path</code> (array) is the ordered list of objectives captured by the player, each of which is an
object with these properties:</p>
<div class="ulist">
<ul>
<li>
<p><em>Target mode only:</em> <code>id</code> (string) is the unique ID of the target</p>
</li>
<li>
<p><em>Target mode only:</em> <code>latitude</code> and <code>longitude</code> (doubles) are the position of the target</p>
</li>
<li>
<p><em>Area mode only:</em> <code>x</code> and <code>y</code> are the <code>AreaDivider</code>-style cell indexes of the cell</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><em>Target mode only:</em> <code>proximityThreshold</code> (integer) is the proximity threshold of the game in meters</p>
</li>
<li>
<p><em>Target mode only:</em> <code>targets</code> (array) is the list of all targets in the game, each of which is an
object with these properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>id</code> (string) is the unique ID of the target</p>
</li>
<li>
<p><code>latitude</code> and <code>longitude</code> (doubles) are the position of the target</p>
</li>
<li>
<p><code>team</code> (integer) is the <code>TeamID</code> code of the team that captured the target, or <code>TeamID.OBSERVER</code>
if not captured yet</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Area mode only:</em> <code>areaNorth</code>, <code>areaEast</code>, <code>areaSouth,</code> and <code>areaWest</code> are the latitude/longitude
of the boundaries of the area</p>
</li>
<li>
<p><em>Area mode only:</em> <code>cellSize</code> (integer) is the requested cell size in meters</p>
</li>
<li>
<p><em>Area mode only:</em> <code>cells</code> (array) is the list of <strong>captured</strong> cells, each of which is an object
with these properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>x</code> and <code>y</code> (integers) are the <code>AreaDivider</code>-style cell indexes</p>
</li>
<li>
<p><code>email</code> (string) is the email of the player who captured the cell</p>
</li>
<li>
<p><code>team</code> (integer) is the <code>TeamID</code> code of the team that captured the cell</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may find this <strong><a href="/MP/2019/fall/files/MP4/full_target.json">example target mode update</a></strong> and
<strong><a href="/MP/2019/fall/files/MP4/full_area.json">example area mode update</a></strong> helpful.</p>
</div>
</div>
<div class="sect3">
<a class="anchor" id="update_gamestate"></a><h4>3.3.2. <code>gameState</code></h4>
<div class="paragraph">
<p>When the game owner changes the game state (paused vs. running vs. ended), a <code>gameState</code>-type
update is sent with this property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>state</code> (integer) is the <code>GameStateID</code> code for the new game state</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An <strong><a href="/MP/2019/fall/files/MP4/gameState.json">example update</a></strong> is available.</p>
</div>
</div>
<div class="sect3">
<a class="anchor" id="update_playerlocation"></a><h4>3.3.3. <code>playerLocation</code></h4>
<div class="paragraph">
<p>When another player&#x2019;s phone reports that they moved, the server relays that position change
with a <code>playerLocation</code>-type update, which has these properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>email</code> (string) is the moved player&#x2019;s email</p>
</li>
<li>
<p><code>lastLatitude</code> and <code>lastLongitude</code> (doubles) are the player&#x2019;s new location</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<a class="anchor" id="update_playerexit"></a><h4>3.3.4. <code>playerExit</code></h4>
<div class="paragraph">
<p>When another player exits the game activity&#x2014;stops actively playing the game&#x2014;the
server relays that change with a <code>playerExit</code>-type event, which has this property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>email</code> (string) is the disconnected player&#x2019;s email</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<a class="anchor" id="update_playertargetvisit"></a><h4>3.3.5. <code>playerTargetVisit</code></h4>
<div class="paragraph">
<p>When another player in a target mode game captures a target, a <code>playerTargetVisit</code>-type
update is sent, which has these properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>email</code> (string) is the capturing player&#x2019;s email</p>
</li>
<li>
<p><code>team</code> (integer) is the <code>TeamID</code> code for the capturing player&#x2019;s team</p>
</li>
<li>
<p><code>targetId</code> (string) is the unique ID of the captured target</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may find this <strong><a href="/MP/2019/fall/files/MP4/playerTargetVisit.json">example update</a></strong> helpful.</p>
</div>
</div>
<div class="sect3">
<a class="anchor" id="update_playercellcapture"></a><h4>3.3.6. <code>playerCellCapture</code></h4>
<div class="paragraph">
<p>When another player in an area mode game captures a target, a <code>playerCellCapture</code>-type
update is sent, which has these properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>email</code> (string) is the capturing player&#x2019;s email</p>
</li>
<li>
<p><code>team</code> (integer) is the <code>TeamID</code> code for the capturing player&#x2019;s team</p>
</li>
<li>
<p><code>x</code> and <code>y</code> (integers) are the <code>AreaDivider</code>-style indexes of the captured cell</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may find this <strong><a href="/MP/2019/fall/files/MP4/playerCellCapture.json">example update</a></strong> helpful.</p>
</div>
</div>
</div>
<div class="sect2">
<a class="anchor" id="clientmessages"></a><h3>3.4. Messages You Send</h3>
<div class="paragraph">
<p>When your app detects, based on changes in location, that the user has affected the game,
the event should be reported to the server. This only needs to be done when the user is a player,
since observers can&#x2019;t affect the game.</p>
</div>
<div class="paragraph">
<p>Like messages from the server to your client, <strong>all these updates should include a <code>type</code> property</strong>
specifying the kind of event.</p>
</div>
<div class="sect3">
<a class="anchor" id="update_locationupdate"></a><h4>3.4.1. <code>locationUpdate</code></h4>
<div class="paragraph">
<p>When the player&#x2019;s phone reports a location update, it should be sent to the server so other
users can see the updated location on their map. The update should also have these properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>latitude</code> and <code>longitude</code> (doubles) are the phone&#x2019;s current location</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may find this <strong><a href="/MP/2019/fall/files/MP4/locationUpdate.json">example update</a></strong> helpful.</p>
</div>
</div>
<div class="sect3">
<a class="anchor" id="update_targetvisit"></a><h4>3.4.2. <code>targetVisit</code></h4>
<div class="paragraph">
<p>When the player captures a target in a target mode game, a <code>targetVisit</code>-type update should be
sent to the server with this property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>targetId</code> (string) is the unique ID of the captured target</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An <strong><a href="/MP/2019/fall/files/MP4/targetVisit.json">example update</a></strong> is available.</p>
</div>
</div>
<div class="sect3">
<a class="anchor" id="update_cellcapture"></a><h4>3.4.3. <code>cellCapture</code></h4>
<div class="paragraph">
<p>When the player captures a cell in an area mode game, a <code>cellCapture</code>-type update should be sent
to the server with these properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>x</code> and <code>y</code> (integers) are the <code>AreaDivider</code>-style indexes of the captured cell</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An <strong><a href="/MP/2019/fall/files/MP4/cellCapture.json">example update</a></strong> is available.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="goal"></a><h2>4. Your Goal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you&#x2019;re finished with Checkpoint 4, the game activity will support multiplayer games in
both target mode and area mode! Other players&apos; movements and objective captures will be displayed
and the user&#x2019;s movements will update the game information on the server when the game is running.
The scores will be shown below the game map and be continuously updated as the user and other
players capture objectives. The game state (paused vs. running) will be displayed and the game owner
will have UI to change it or end the game. When the game is ended, the winning team will be displayed
in a popup.</p>
</div>
<div class="paragraph">
<p>MP4 may sound scary at first&#x2014;there are several new moving parts&#x2014;so <strong>start early</strong>
and take it one step at a time. Fortunately, you have your previous code to refer to for help.
Feel free to come to office hours or post on the <a href="https://cs125-forum.cs.illinois.edu/c/fall2019-mp/mp4" class="noexternal">forum</a> when stuck.</p>
</div>
<div class="paragraph">
<p>Unless otherwise specified, the following tasks can be done in any order.</p>
</div>
<div class="sect2">
<a class="anchor" id="connectwebsocket"></a><h3>4.1. Connecting</h3>
<div class="paragraph">
<p>After you paste in the new <code>GameActivity</code> starter code from <a href="#obtaining">Obtaining MP4</a>,
the game activity will have several useful functions but will only show an empty map.
To start getting the user in the multiplayer game, the activity will need to connect to the
websocket for the game. We have provided the <code>connectWebSocket</code> function to start that process,
but it relies on the game ID being stored in the <code>gameId</code> instance variable.</p>
</div>
<div class="paragraph">
<p>Recall from <a href="/MP/2019/fall/2/#_invitationgame_buttons">MP2&#x2019;s <code>MainActivity</code> Enter buttons</a> that the game ID
is passed to the game activity in the <code>game</code> extra of the intent.
<strong>You need to fill in</strong> <code>GameActivity</code>&apos;s <code>onCreate</code> to store the game ID,
<a href="/MP/2019/fall/1/#_multiple_activities">retrieved from the intent</a>, in the <code>gameId</code> instance variable
then call the <code>connectWebSocket</code> function to connect to the websocket.</p>
</div>
<div class="paragraph">
<p>After completing this task, <code>testWebSocket</code> will pass. When the server sends an update via
websocket, the message will be passed to your <code>receivedData</code> function, which you will complete
in later sections.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="gamestate"></a><h3>4.2. Game State</h3>
<div class="paragraph">
<p>You will need to finish the previous section before starting this one.</p>
</div>
<div class="paragraph">
<p>The <a href="#update_full"><code>full</code> update</a> sent by the server shortly after the websocket is connected
specifies the current game state, either paused or running. The <code>updateGameState</code> helper
function, which <strong>you need to fill in</strong>, is responsible for recording that new state in the
<code>gameState</code> instance variable and updating the UI to match.
The state code it&#x2019;s passed can be checked against
<code>GameStateID</code> constants <span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;declared in &lt;code&gt;Constants.java&lt;/code&gt;&lt;/body&gt;&lt;/html&gt;">4</span> to determine the current state.
We provided two views whose text you will need to update:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>gameState</code> label should say &quot;Running&quot; when the game is running and &quot;Paused&quot; when it&#x2019;s paused</p>
</li>
<li>
<p>The <code>pauseUnpauseGame</code> button&#x2019;s text should be &quot;Pause&quot; when the game is running and &quot;Resume&quot;
when it&#x2019;s paused</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After implementing <code>updateGameState</code>, you need to <strong>fill in the <code>full</code> case</strong> of the <code>receivedData</code>
function to call that helper function, passing it the current game state.
Ignore the comment about the game instance variable for now&#x2014;we&#x2019;ll come back to that
in the next section.</p>
</div>
<div class="paragraph">
<p>We have provided UI and code that allows the game owner to pause and resume the game.
These actions generate a <a href="#update_gamestate"><code>gameState</code> update</a> sent to all participants
in the game via websocket. To keep the game state label continuously up to date, <strong>fill in the
<code>gameState</code> case</strong> of <code>receivedData</code> to pass the new state to your helper function.
Don&#x2019;t worry about detecting game-over yet: that will be handled at the end of the checkpoint.</p>
</div>
<div class="paragraph">
<p>After completing this task, <code>testGameStateDisplay</code> will pass.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="subclasses"></a><h3>4.3. Using <code>Game</code> Subclasses</h3>
<div class="paragraph">
<p>Putting game logic for both game modes directly in <code>GameActivity</code> makes that one class
responsible for a lot. Rather than using if statements in several places, it would be nice if
the activity could trigger appropriate gameplay logic without always needing to check the game mode.
This can be accomplished by taking advantage of polymorphism: a game object can be notified
through a consistent interface of events that affect the game.</p>
</div>
<div class="paragraph">
<p>We have provided an abstract
<a href="https://cs125-illinois.github.io/Fall2019-MP-Writeups/4/edu/illinois/cs/cs125/fall2019/mp/Game.html" target="_blank" class="external"><code>Game</code> class</a>
that represents a multiplayer game. It handles behavior used in all games, like showing circles
on the map at the locations of other players, and provides helper functions that will be useful
for implementing game-specific subclasses. Mode-specific logic will go in the overrides of four
methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The constructor is responsible for loading the current progress of the game and rendering
that on the map.</p>
</li>
<li>
<p><code>locationUpdated</code> updates the running game according to the user&#x2019;s movements, much like
<code>updateLocation</code> from the old <code>GameActivity</code> but specific to one game mode. When the player&#x2019;s
movements cause something to happen, it updates appropriate instance variables, draws on the map,
and sends updates to the server.</p>
</li>
<li>
<p><code>handleMessage</code> updates the game progress and map according to an update from the server about
another player&#x2019;s activity.</p>
</li>
<li>
<p><code>getTeamScore</code> returns how many objectives the given team has captured so far. This will be
used for scoring near the end of the checkpoint.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#x2019;re not going to <em>implement</em> those quite yet, but we will set up <code>GameActivity</code> to <em>use</em> them
so you can test your gameplay logic in the emulator if you like.</p>
</div>
<div class="sect3">
<a class="anchor" id="usinggame"></a><h4>4.3.1. Connecting <code>GameActivity</code> to <code>Game</code></h4>
<div class="paragraph">
<p>The app only knows which subclass is needed once the <code>full</code> update is received to specify the
game mode. <strong>Fill in the other part of that case in <code>receivedData</code></strong> to initialize the
<code>game</code> instance variable with a new <code>TargetGame</code> or <code>AreaGame</code> as appropriate for the mode.
You have variables for almost all the constructor parameters <span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;refer to the &lt;code&gt;Game&lt;/code&gt; code or &lt;a href=&quot;https://cs125-illinois.github.io/Fall2019-MP-Writeups/4/edu/illinois/cs/cs125/fall2019/mp/Game.html#Game-java.lang.String-com.google.android.gms.maps.GoogleMap-com.neovisionaries.ws.client.WebSocket-com.google.gson.JsonObject-android.content.Context-&quot; target=&quot;_blank&quot; class=&quot;external&quot;&gt;the Javadoc&lt;/a&gt; for what you need to pass&lt;/body&gt;&lt;/html&gt;">5</span>; the last parameter, <code>context</code>, can be the activity itself
<span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;that is, the current &lt;code&gt;GameActivity&lt;/code&gt; instance&lt;/body&gt;&lt;/html&gt;">6</span>.
Once the game object is set, other parts of the activity code can use it without needing to
care about the specific game mode.</p>
</div>
<div class="paragraph">
<p>The activity itself handles the <code>full</code> update and <code>gameState</code> updates, but all others have to do
with gameplay and should be handled by the game object. <strong>Fill in the default case</strong> in
<code>receivedData</code> to call the game object&#x2019;s <code>handleMessage</code> function with the received update.</p>
</div>
<div class="paragraph">
<p>When the phone moves, <code>GameActivity</code> is notified and calls its own <code>updateLocation</code> function.
To make the user&#x2019;s movements affect the game and be sent to the server, you will need to <strong>fill
in <code>updateLocation</code></strong>:</p>
</div>
</div>
<div class="sect3">
<a class="anchor" id="updatelocation"></a><h4>4.3.2. <code>updateLocation</code> Logic</h4>
<div class="paragraph">
<p>As noted in the comments provided inside that function, observers only watch the game and do not
affect it. So if the user&#x2019;s role in the game is Observer, the function should return before
doing anything interesting. The game object provides a method that will be helpful for checking
this.</p>
</div>
<div class="paragraph">
<p>So that other players&apos; maps show your user&#x2019;s location, set up a
<a href="#update_locationupdate"><code>locationUpdate</code> update</a> that the provided code can transmit over the
websocket.</p>
</div>
<div class="paragraph">
<p>Movements shouldn&#x2019;t affect a paused game, so only if the game is in the running state,
call <code>locationUpdated</code> on the game object.</p>
</div>
<div class="paragraph">
<p>After completing this function, <code>testLocationUpdates</code> will pass. Other work in this section will
be tested indirectly by later sections. If you&#x2019;re not sure whether you successfully connected
<code>GameActivity</code> to <code>Game</code> functions, add print statements <span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;or use the debugger&lt;/body&gt;&lt;/html&gt;">7</span> to trace
the flow of execution to make sure <code>Game</code> functions are being entered when the test suite expects
things to be happening.</p>
</div>
</div>
</div>
<div class="sect2">
<a class="anchor" id="targetmode"></a><h3>4.4. Target Mode Gameplay</h3>
<div class="paragraph">
<p>A visual explanation of this section is available <span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;narrated by Nikhil&lt;/body&gt;&lt;/html&gt;">8</span>:</p>
</div>
<div class="row justify-content-center mt-3 mb-3">
  <div class="col-12 col-lg-8">
    <div class="embed-responsive embed-responsive-4by3">
      <div class="lazyiframe" data-attribs="%7B%22class%22:%22embed-responsive-item%22,%22width%22:%22560%22,%22height%22:%22315%22,%22src%22:%22//www.youtube.com/embed/yqd-_0E6gBk%22,%22allowfullscreen%22:%22%22%7D"></div>
    </div>
  </div>
</div>
<div class="paragraph">
<p>We have provided a <em>partially</em> complete
<a href="https://cs125-illinois.github.io/Fall2019-MP-Writeups/4/edu/illinois/cs/cs125/fall2019/mp/TargetGame.html" target="_blank" class="external"><code>TargetGame</code> class</a>
that represents a multiplayer target mode game. Your job is to fill out the missing parts to
make target mode games work.</p>
</div>
<div class="paragraph">
<p>In addition to calling the <code>Game</code> constructor with <code>super</code>, <code>TargetGame</code>&apos;s constructor
loads targets and paths from the JSON, storing them in instance variables and drawing them.
It stores all targets in the <code>targets</code> <a href="#maps">map</a> variable, looked up by the unique ID
assigned to each by the server. Each player&#x2019;s path is a list of the IDs of the targets they captured,
stored as a <code>List&lt;String&gt;</code> as a value of the <code>playerPaths</code> map variable.</p>
</div>
<div class="paragraph">
<p>The data loading is correct, but the drawing depends on the
<strong><code>addLineSegment</code> helper function which you need to implement</strong>.
Getting the team colors array resource is very similar to how you
<a href="/MP/2019/fall/2/#_accessing_resources">got the names resource</a> in MP2 except that colors are stored as
<code>int</code>s, so <code>team_colors</code> is an integer array resource accessible with <code>getIntArray</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">getContext().getResources().getIntArray(R.array.team_colors)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As before, you can index the array using a team ID: the <code>team</code> parameter passed to your function.</p>
</div>
<div class="paragraph">
<p>To make the user&#x2019;s movements affect the game, you will need to put <strong>target mode gameplay logic
in <code>locationUpdated</code></strong>. You will probably <em>not</em> want to use <code>TargetVisitChecker</code>, but the
overall approach is the same as in Checkpoint 0:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Iterate over <code>targets</code> (see <a href="#maps">Maps</a>) to find a target that&#x2019;s within the proximity threshold.
We suggest organizing the rest of the logic into the <code>tryClaimTarget</code> helper function
which can focus on just one target.</p>
</li>
<li>
<p>Make sure the target isn&#x2019;t already captured by any team.</p>
</li>
<li>
<p>If the player has captured a target already, check the hypothetical new line for crosses
with existing lines from <em>any</em> player&#x2019;s path. Here the <code>playerPaths</code> map will be helpful.</p>
</li>
<li>
<p>If the snake rule is satisfied, capture the target.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Your <code>Target</code> class can change the marker&#x2019;s color for you.</p>
</li>
<li>
<p>The provided <code>extendPlayerPath</code> function can update the instance variables and add a line.</p>
</li>
<li>
<p>To notify the server of the capture, build a <a href="#update_targetvisit"><code>targetVisit</code> update</a>
and send it with the protected <code>sendMessage</code> function.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="openblock alert alert-warning">
<div class="content">
<div class="paragraph">
<p>Since <code>Game</code> subclasses should work in isolation from the app and Firebase, <strong>they should not
use <code>FirebaseAuth</code> to get the player&#x2019;s email</strong>. Instead, <code>Game</code> provides a protected <code>getEmail</code>
function to retrieve the email passed to the constructor.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>To show captures made by other players, you will need to <strong>add a little logic to <code>handleMessage</code></strong>.
The case that deals with <a href="#update_playertargetvisit"><code>playerTargetVisit</code> updates</a> has some
provided code to get the properties of the update. You need to use those to change the
target&#x2019;s marker color and extend the player&#x2019;s path.</p>
</div>
<div class="paragraph">
<p>After completing this work, <code>testMultiplePlayersTargetMode</code> will pass. We&#x2019;ll come back to
<code>getTeamScore</code> later. You can delete the fairly gross <code>TargetVisitChecker</code> class now that
target mode gameplay is handled in a nicer way&#x2014;previous checkpoints&apos; test suites are
forward-compatible.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="areamode"></a><h3>4.5. Area Mode Gameplay</h3>
<div class="paragraph">
<p>The MP4 patch includes much more starter code for target mode than area mode,
so you may prefer to finish <a href="#targetmode">Target Mode Gameplay</a> first for an example.</p>
</div>
<div class="paragraph">
<p>A visual explanation of this section is available <span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;again narrated by Nikhil&lt;/body&gt;&lt;/html&gt;">9</span>:</p>
</div>
<div class="row justify-content-center mt-3 mb-3">
  <div class="col-12 col-lg-8">
    <div class="embed-responsive embed-responsive-4by3">
      <div class="lazyiframe" data-attribs="%7B%22class%22:%22embed-responsive-item%22,%22width%22:%22560%22,%22height%22:%22315%22,%22src%22:%22//www.youtube.com/embed/Lw89kpeB_ks%22,%22allowfullscreen%22:%22%22%7D"></div>
    </div>
  </div>
</div>
<div class="paragraph">
<p>The
<a href="https://cs125-illinois.github.io/Fall2019-MP-Writeups/4/edu/illinois/cs/cs125/fall2019/mp/AreaGame.html" target="_blank" class="external"><code>AreaGame</code> class</a>
is responsible for multiplayer area mode games. It has the same
public functions as <code>TargetGame</code>, but with the different rules for that game mode, the implementations
will be different. Specifically, <strong>you need to implement this logic</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The constructor is responsible for loading the area configuration, cell ownerships, and
the player&#x2019;s last capture from the JSON. It should render the area grid <span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;probably using a class you made in a previous checkpoint&lt;/body&gt;&lt;/html&gt;">10</span> and fill in captured cells with the capturing team&#x2019;s
color. <span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;You&amp;#x2019;ll want a helper function for this, since polygons will be added from other functions too.&lt;/body&gt;&lt;/html&gt;">11</span></p>
</li>
<li>
<p><code>locationUpdated</code> is responsible for detecting, displaying, and reporting area mode updates
made by the player. If the user entered an uncaptured cell satisfying the
<a href="/MP/2019/fall/1/#_area_mode_gameplay">area mode snake rule</a>, it should:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>record the change in your instance variables,</p>
</li>
<li>
<p>add a polygon on the cell colored with the player&#x2019;s team color, and</p>
</li>
<li>
<p>send a <a href="#update_cellcapture"><code>cellCapture</code> update</a> to the server.</p>
</li>
</ol>
</div>
</li>
<li>
<p><code>handleMessage</code> is responsible for showing cell captures made by other players, which it is
notified of by <a href="#update_playercellcapture"><code>playerCellCapture</code> updates</a>. When that happens,
instance variables should be updated and a colored polygon should be added to show the capture.
Other kinds of updates should be delegated to the superclass.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Much of this logic can be reused from or based on the area mode logic you wrote in Checkpoint 1.
You may not assume, however, that the user is entering the game for the first time&#x2014;your
constructor will need to load the existing game progress, which may include a previous capture
already made by the user.</p>
</div>
<div class="paragraph">
<p>After completing this work, <code>testMultiplePlayersAreaMode</code> will pass. <code>getTeamScore</code> will be
tested in the next section.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="scoring"></a><h3>4.6. Scoring</h3>
<div class="paragraph">
<p>You should complete all previous sections before starting this one.</p>
</div>
<div class="paragraph">
<p>Before the game can determine a winner, it will need to have a concept of score.
We define a team&#x2019;s score as the number of objectives&#x2014;targets or cells&#x2014;it has
captured. <strong>Fill in the <code>getTeamScore</code> implementation of both <code>Game</code> subclasses</strong> to count
the given team&#x2019;s captured objectives according to the current values in their instance variables.</p>
</div>
<div class="paragraph">
<p>We have provided a <code>gameScores</code> label in the game activity layout to show the scores.
<strong>Fill in the <code>updateScores</code> helper function</strong> in <code>GameActivity</code> to set that label&#x2019;s text according
to the scores of all four teams according to the game object.</p>
</div>
<div class="paragraph">
<p>That label should be kept up to date with the game, so you will need to <strong>call that helper function</strong>
from several places. New score information may be available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When initial information about the game is received</p>
</li>
<li>
<p>After an update is received from the server</p>
</li>
<li>
<p>After the player moves in a running game</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After completing these tasks, <code>testScoring</code> will pass.</p>
</div>
</div>
<div class="sect2">
<a class="anchor" id="gameover"></a><h3>4.7. Game Over</h3>
<div class="paragraph">
<p>You should complete all previous sections before starting this one.</p>
</div>
<div class="paragraph">
<p>When handling <a href="#gamestate">Game State</a> you took care of the paused and running states.
That update is also sent when the game is ended by the owner. In that case,
<strong>you need to show a popup/dialog</strong> stating the winning team.</p>
</div>
<div class="paragraph">
<p>The winning team is the one with the most points as reported by the game object&#x2019;s <code>getTeamScore</code>
function. Ties are not tested and you may do anything you think is reasonable in that case.
You can look up a team name by team ID using the <code>team_choices</code>
<a href="/MP/2019/fall/2/#_accessing_resources">resource</a>.</p>
</div>
<div class="paragraph">
<p>To show a popup, create and show an
<a href="https://developer.android.com/guide/topics/ui/dialogs.html#AlertDialog" target="_blank" class="external"><code>AlertDialog</code></a>
similar to the example in the provided <code>endGame</code> function. The message should state the winner,
e.g. &quot;Red wins!&quot;, and <strong>dismissing the dialog should finish the activity</strong>. You only need
one button <span class="badge badge-illinois-orange" data-toggle="popover" data-placement="top" data-html="true" data-content="&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;technically you don&amp;#x2019;t need any but the user would probably want a button&lt;/body&gt;&lt;/html&gt;">12</span>
and it can say anything you like.</p>
</div>
<div class="paragraph">
<p>You can register a handler with <code>setOnDismissListener</code> that will run even if the user taps
outside the dialog to close it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java spelling_exception lang-java" data-lang="java">builder.setOnDismissListener(unused -&gt; /* your code here */)</code></pre>
</div>
</div>
<div class="paragraph">
<p>After completing this task, <code>testGameOver</code> will pass. Well done!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="grading"></a><h2>5. Grading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MP4 is worth 100 points total, broken down as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>5 points</strong> for connecting to the game&#x2019;s websocket</p>
</li>
<li>
<p><strong>5 points</strong> for displaying the game state</p>
</li>
<li>
<p><strong>5 points</strong> for sending location updates to the server when appropriate</p>
</li>
<li>
<p><strong>25 points</strong> for multiplayer target mode gameplay</p>
</li>
<li>
<p><strong>25 points</strong> for multiplayer area mode gameplay</p>
</li>
<li>
<p><strong>10 points</strong> for scoring (<code>getTeamScore</code> implementations and score display)</p>
</li>
<li>
<p><strong>5 points</strong> for the game-over popup</p>
</li>
<li>
<p><strong>10 points</strong> for passing <code>checkstyle</code> inspection</p>
</li>
<li>
<p><strong>10 points</strong> for submitting code that earns at least <em>40 points</em> by 8 PM
on your early deadline day</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your app will be tested by <code>Checkpoint4Test</code>. Understanding the details of how the tests work
is not necessary, but reading what checks it makes may help you understand what your code
is supposed to do.</p>
</div>
<div class="openblock alert alert-warning">
<div class="content">
<div class="paragraph">
<p>After submitting, <strong>always check</strong> that your commit appeared on the
<a href="/m/grades/MPs">official MP grades page</a> with the score you expected. Investigate and/or
get help <em>immediately</em> if something seems to be wrong.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="cheating"></a><h2>6. Cheating</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="/info/2019/fall/syllabus/#cheating">cheating policies</a> in the syllabus continue to apply.
You may of course copy and use all the code we provided to you, but for the parts we expect
you to complete, submitting work done by anyone else is unacceptable.
<strong>We will check <em>all</em> submissions from <em>every</em> checkpoint for plagiarism.</strong></p>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="epilogue"></a><h2>7. Epilogue</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Congratulations! You have completed the Machine Project.</strong>
Campus Snake 125 should now be fully functional. If deployed onto a physical phone,
it can actually work; you can go outside and play the game!</p>
</div>
<div class="paragraph">
<p>Over the course of this project, you exercised many concepts learned in lecture and learned
several important software engineering principles. Being immersed in Android app development
prepared you for your final project, for which you can build any Android app you like&#x2014;no
specification, no test suites, no limitations. The world is yours!</p>
</div>
</div>
</div>

    </main>
  </div>
</div>

<div class="container hidden-print">
  <div class="row" style="margin-top: 10px; margin-bottom: 20px;">
    <div class="col-xs-12">
      <hr>
    </div>
    <div class="small col-xs-12 col-md-4 col-md-offset-4 text-center">
      Created 10/24/2021 <br>
      Updated 10/24/2021
    </div>
    <div class="small col-xs-12 col-md-4 text-center">
      <a class="link_exception external" href="https://github.com/cs125-illinois/www/commit/757182888eb7ea986f2788b840e32ee4da2480f8" target="_blank">Commit <code>7571828</code></a>
      //
      <a class="link_exception external" href="https://github.com/cs125-illinois/www/commits/master/src/MP/2019/fall/4.adoc" target="_blank">History</a> //
      <a class="link_exception external" href="https://github.com/cs125-illinois/www/blob/master/src/MP/2019/fall/4.adoc" target="_blank">View</a>
      <br>
      Built 10/24/2021 @ 20:44 EDT
    </div>
  </div>
</div>

<script src="/static-assets/highlight.c2ac4dbbbfbaa664d982.js"></script>







</body></html><!--
  vim: et:ts=2:sw=2:ft=html
--><!--
  vim: et:ts=2:sw=2:ft=html
-->